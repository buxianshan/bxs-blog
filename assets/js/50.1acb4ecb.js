(window.webpackJsonp=window.webpackJsonp||[]).push([[50],{466:function(s,a,t){"use strict";t.r(a);var n=t(36),e=Object(n.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{align:"center"}},[s._v("打包项目到PyPI")]),s._v(" "),t("h2",{attrs:{id:"简介"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#简介"}},[s._v("#")]),s._v(" 简介")]),s._v(" "),t("p",[s._v("记录一下自己学习把包发布到PyPI的过程，写了一个demo。")]),s._v(" "),t("p",[s._v("demo源文件："),t("a",{attrs:{href:"https://github.com/buxianshan/python-packaging-demo",target:"_blank",rel:"noopener noreferrer"}},[s._v("python-packaging-demo"),t("OutboundLink")],1)]),s._v(" "),t("p",[s._v("TestPyPI页面："),t("a",{attrs:{href:"https://test.pypi.org/project/bxs/",target:"_blank",rel:"noopener noreferrer"}},[s._v("bxs-TestPyPI"),t("OutboundLink")],1)]),s._v(" "),t("h2",{attrs:{id:"pypi是什么"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#pypi是什么"}},[s._v("#")]),s._v(" PyPI是什么")]),s._v(" "),t("p",[s._v("PyPI 是 Python Package Index 的首字母简写，表示的是 Python 的 Packag 索引，也是 Python 的官方索引。")]),s._v(" "),t("p",[s._v("我们平时使用pip下载的包就是PyPI中的，使用国内的镜像下载也是会同步PyPI的。例如清华的镜像站：")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://buxianshan.oss-cn-beijing.aliyuncs.com/Typora_images/image-20220318103407734.png",alt:"image-20220318103407734"}})]),s._v(" "),t("h2",{attrs:{id:"如何发布自己的-python-包到pypi"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#如何发布自己的-python-包到pypi"}},[s._v("#")]),s._v(" 如何发布自己的 python 包到PyPI")]),s._v(" "),t("p",[s._v("参考官方文档："),t("a",{attrs:{href:"https://packaging.python.org/en/latest/tutorials/packaging-projects/",target:"_blank",rel:"noopener noreferrer"}},[s._v("Packaging Python Projects"),t("OutboundLink")],1)]),s._v(" "),t("h3",{attrs:{id:"项目结构"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#项目结构"}},[s._v("#")]),s._v(" 项目结构")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("packaging_tutorial/\n├── LICENSE\n├── pyproject.toml\n├── README.md\n├── setup.cfg\n├── src/\n│   └── example_package/\n│       ├── __init__.py\n│       └── example.py\n└── tests/\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br")])]),t("p",[s._v("官方文档里有每个文件的详细说明，这里就不赘述了。")]),s._v(" "),t("h3",{attrs:{id:"打包"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#打包"}},[s._v("#")]),s._v(" 打包")]),s._v(" "),t("p",[s._v("确保使用build工具最新版：")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("python -m pip "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" --upgrade build\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("在"),t("code",[s._v("pyproject.toml")]),s._v("所在的目录下执行：")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("python -m build\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("会在当前目录下生成dist文件夹，包含两个文件：")]),s._v(" "),t("ul",[t("li",[s._v("package-name-0.0.1-py3-none-any.whl")]),s._v(" "),t("li",[s._v("package-name-0.0.1.tar.gz")])]),s._v(" "),t("p",[s._v("顺便提一下，这个whl文件已经可以本地直接安装了：")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("pip "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" package-name-0.0.1-py3-none-any.whl\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h3",{attrs:{id:"上传到pypi"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#上传到pypi"}},[s._v("#")]),s._v(" 上传到PyPI")]),s._v(" "),t("p",[s._v("注意区分"),t("a",{attrs:{href:"https://pypi.org/",target:"_blank",rel:"noopener noreferrer"}},[s._v("PyPI"),t("OutboundLink")],1),s._v("和"),t("a",{attrs:{href:"https://test.pypi.org/",target:"_blank",rel:"noopener noreferrer"}},[s._v("TestPyPI"),t("OutboundLink")],1),s._v("。TestPyPI也是官方推荐的平台，其实就是让你可以在正式发布到PyPI前，可以使用TestPyPI来测试发布。这两个网站都要注册账号。")]),s._v(" "),t("p",[s._v("我这里使用的是TestPyPI，因为这个demo只是用来学习，没必要发布到PyPI。")]),s._v(" "),t("p",[s._v("首先安装"),t("a",{attrs:{href:"https://packaging.python.org/en/latest/key_projects/#twine",target:"_blank",rel:"noopener noreferrer"}},[s._v("twine"),t("OutboundLink")],1),s._v("，也是官方文档建议的工具：")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("python -m pip "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" --upgrade twine\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("使用twine把包上传到TestPyPI：")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("python -m twine upload --repository testpypi dist/*\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("这个过程中将会提示输入TestPyPI的用户名和密码：")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("PS D:\\code\\bxs_package> python -m twine upload --repository testpypi dist/*\nUploading distributions to https://test.pypi.org/legacy/\nEnter your username: buxianshan\nEnter your password:\nUploading bxs-0.0.2-py3-none-any.whl\n100%|█████████████████████████████████████████████████████████████████████████████| 5.80k/5.80k [00:02<00:00, 2.08kB/s]\nUploading bxs-0.0.2.tar.gz\n100%|█████████████████████████████████████████████████████████████████████████████| 5.73k/5.73k [00:01<00:00, 3.85kB/s]\n\nView at:\nhttps://test.pypi.org/project/bxs/0.0.2/\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br")])]),t("p",[s._v("上传完成后会给一个链接，就可以在TestPyPI上看到自己的包了：")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://buxianshan.oss-cn-beijing.aliyuncs.com/Typora_images/image-20220318111411250.png",alt:"image-20220318111411250"}})]),s._v(" "),t("h3",{attrs:{id:"安装自己的包"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#安装自己的包"}},[s._v("#")]),s._v(" 安装自己的包")]),s._v(" "),t("p",[s._v("安装我的这个demo：")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("pip "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" -i https://test.pypi.org/simple/ bxs\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# pip list看一下")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# pip list")]),s._v("\nPackage            Version\n------------------ ---------\nbxs                "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".2\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("p",[s._v("正常使用：")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# python3")]),s._v("\nPython "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.7")]),s._v(".2 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("default, Jan "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2022")]),s._v(", "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v(":20:27"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" \n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("GCC "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4.8")]),s._v(".5 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("20150623")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Red Hat "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4.8")]),s._v(".5-44"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" on linux\nType "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"help"')]),s._v(", "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"copyright"')]),s._v(", "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"credits"')]),s._v(" or "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"license"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("more")]),s._v(" information.\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" from bxs "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("import")]),s._v(" this\nHello"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v(" This is bxs.\nWelcome to my blog: https://bxs.ink/\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" \n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br")])]),t("h3",{attrs:{id:"特别注意"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#特别注意"}},[s._v("#")]),s._v(" 特别注意")]),s._v(" "),t("p",[s._v("在PyPI不能上传相同的文件名，例如第一次上传了v1，以后都不能再上传v1了，即使把v1删掉了也不能重新上传！")]),s._v(" "),t("p",[s._v("会报错：")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("Error during upload. Retry with the --verbose option "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("more")]),s._v(" details.\nHTTPError: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("400")]),s._v(" Bad Request from https://test.pypi.org/legacy/\nFile already exists. See https://test.pypi.org/help/"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#file-name-reuse for more information.")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[s._v("有人解释的原因是：旧文件名将被标记为无限期缓存，因此即使您可以上传具有相同名称的文件名，如果他们已经获取旧版本，他们将永远不会获得新版本。")]),s._v(" "),t("p",[s._v("参考："),t("a",{attrs:{href:"https://github.com/pypa/packaging-problems/issues/74",target:"_blank",rel:"noopener noreferrer"}},[s._v("In pypi, it is impossible to reupload a removed file."),t("OutboundLink")],1)])])}),[],!1,null,null,null);a.default=e.exports}}]);